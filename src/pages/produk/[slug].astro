---
/**
 * Product Detail Page
 * Dynamic product page with specs and gallery
 */
import BaseLayout from "../../layouts/BaseLayout.astro";
import CTA from "../../components/CTA.astro";
import {
    fetchProductBySlug,
    fetchProducts,
    STATIC_PRODUCTS,
} from "../../lib/wordpress";

// Get static paths for SSG
export async function getStaticPaths() {
    let products = await fetchProducts(100);

    if (!products || products.length === 0) {
        products = STATIC_PRODUCTS;
    }

    return products.map((product) => ({
        params: { slug: product.slug },
        props: { product },
    }));
}

const { slug } = Astro.params;
let { product } = Astro.props;

// Fallback if not passed via props
if (!product) {
    product = (await fetchProductBySlug(slug as string))!;

    if (!product) {
        product =
            STATIC_PRODUCTS.find((p) => p.slug === slug) || STATIC_PRODUCTS[0];
    }
}
---

<BaseLayout
    title={product.title}
    description={product.focus}
    image={product.image}
>
    <!-- Hero Section -->
    <section class="bg-[#072181] pt-32 pb-20 relative overflow-hidden">
        <div
            class="absolute inset-0 opacity-10"
            style="background-image: radial-gradient(#ffffff 1px, transparent 1px); background-size: 32px 32px;"
        >
        </div>

        <div class="container mx-auto px-4 md:px-6 relative z-10">
            <!-- Breadcrumb -->
            <nav class="mb-6">
                <ol class="flex items-center gap-2 text-sm text-blue-200">
                    <li><a href="/" class="hover:text-white">Beranda</a></li>
                    <li>/</li>
                    <li>
                        <a href="/produk" class="hover:text-white">Produk</a>
                    </li>
                    <li>/</li>
                    <li class="text-white">{product.title}</li>
                </ol>
            </nav>

            <div class="max-w-3xl">
                <span
                    class="inline-block px-3 py-1 rounded-sm bg-yellow-500 text-white text-xs font-bold uppercase tracking-wider mb-4"
                >
                    {product.tag}
                </span>
                <h1
                    class="text-4xl md:text-5xl font-bold text-white mb-4 tracking-tight"
                >
                    {product.title}
                </h1>
                <p class="text-xl text-blue-100/80 leading-relaxed">
                    {product.focus}
                </p>
            </div>
        </div>
    </section>

    <!-- Product Details -->
    <section class="py-16 bg-white">
        <div class="container mx-auto px-4 md:px-6">
            <div class="grid lg:grid-cols-2 gap-12 items-start">
                <!-- Image -->
                <div class="rounded-2xl overflow-hidden shadow-xl">
                    <img
                        src={product.image}
                        alt={product.title}
                        class="w-full h-auto object-cover"
                    />
                </div>

                <!-- Specs -->
                <div>
                    <h2 class="text-2xl font-bold text-slate-900 mb-6">
                        Spesifikasi Produk
                    </h2>

                    <div
                        class="bg-slate-50 rounded-xl p-6 border border-slate-100"
                    >
                        <ul class="space-y-4">
                            {
                                product.specs.map((spec) => (
                                    <li class="flex flex-col md:flex-row md:items-center border-b border-slate-200 pb-4 last:border-0 last:pb-0">
                                        <span class="font-bold text-slate-500 uppercase tracking-wide text-xs mb-1 md:mb-0 md:w-1/3">
                                            {spec.label}
                                        </span>
                                        <span class="text-slate-900 font-medium md:w-2/3">
                                            {spec.value}
                                        </span>
                                    </li>
                                ))
                            }
                        </ul>
                    </div>

                    <!-- CTA Buttons -->
                    <div class="mt-8 flex flex-col sm:flex-row gap-4">
                        <a
                            href={`https://wa.me/6281234567890?text=Halo%2C%20saya%20tertarik%20dengan%20produk%20${encodeURIComponent(product.title)}`}
                            target="_blank"
                            rel="noopener noreferrer"
                            class="inline-flex h-12 items-center justify-center rounded-md bg-[#25D366] hover:bg-[#20bd5a] text-white font-bold text-sm uppercase tracking-wide px-8 gap-2 transition-colors"
                        >
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                width="18"
                                height="18"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                            >
                                <path
                                    d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"
                                ></path>
                            </svg>
                            Tanya via WhatsApp
                        </a>
                        <a
                            href="/kontak#penawaran"
                            class="inline-flex h-12 items-center justify-center rounded-md bg-[#072181] hover:bg-[#05165a] text-white font-bold text-sm uppercase tracking-wide px-8 transition-colors"
                        >
                            Minta Penawaran
                        </a>
                    </div>
                </div>
            </div>

            <!-- Description -->
            {
                product.content && (
                    <div class="mt-16 max-w-3xl">
                        <h2 class="text-2xl font-bold text-slate-900 mb-6">
                            Deskripsi Produk
                        </h2>
                        <div
                            class="prose prose-slate max-w-none"
                            set:html={product.content}
                        />
                    </div>
                )
            }
        </div>
    </section>

    <!-- CTA -->
    <CTA />
</BaseLayout>
