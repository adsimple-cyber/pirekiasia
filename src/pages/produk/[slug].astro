---
/**
 * Product Detail Page
 * Dynamic product page with Bento Grid layout and specs
 */
export const prerender = true;
import BaseLayout from "../../layouts/BaseLayout.astro";
import CTA from "../../components/CTA.astro";
import {
    fetchProductBySlug,
    fetchProducts,
    STATIC_PRODUCTS,
} from "../../lib/wordpress";
import type { Product } from "../../lib/wordpress";

// Get static paths for SSG
export async function getStaticPaths() {
    let products = await fetchProducts(100);

    if (!products || products.length === 0) {
        products = STATIC_PRODUCTS;
    }

    return products.map((product) => ({
        params: { slug: product.slug },
        props: { product },
    }));
}

const { slug } = Astro.params;
let { product } = Astro.props as { product: any }; // Using any to bypass strict type checking for new properties

// Fallback if not passed via props
if (!product) {
    product = (await fetchProductBySlug(slug as string))!;

    if (!product) {
        product =
            STATIC_PRODUCTS.find((p) => p.slug === slug) || STATIC_PRODUCTS[0];
    }
}

// Icon helper (mapping strings to SVG paths or using a library if available, for now simple SVGs)
const getIcon = (name: string) => {
    switch (name) {
        case "volume-x":
            return `<path d="M11 5L6 9H2v6h4l5 4V5zM23 9l-6 6M17 9l6 6"/>`;
        case "minus":
            return `<path d="M5 12h14"/>`;
        case "lock":
            return `<rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/>`;
        case "palette":
            return `<circle cx="13.5" cy="6.5" r=".5"/><circle cx="17.5" cy="10.5" r=".5"/><circle cx="8.5" cy="7.5" r=".5"/><circle cx="6.5" cy="12.5" r=".5"/><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z"/>`;
        case "dollar-sign":
            return `<line x1="12" x2="12" y1="1" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>`;
        case "minimize":
            return `<path d="M8 3v3a2 2 0 0 1-2 2H3"/><path d="M21 8h-3a2 2 0 0 1-2-2V3"/><path d="M3 16h3a2 2 0 0 1 2 2v3"/><path d="M16 21v-3a2 2 0 0 1 2-2h3"/>`;
        case "arrow-down":
            return `<line x1="12" y1="5" x2="12" y2="19"/><polyline points="19 12 12 19 5 12"/>`;
        case "mic-off":
            return `<line x1="1" y1="1" x2="23" y2="23"/><path d="M9 9v3a3 3 0 0 0 5.12 2.12M15 9.34V4a3 3 0 0 0-5.94-.6"/><path d="M17 16.95A7 7 0 0 1 5 12v-2m14 0v2a7 7 0 0 1-.11 1.23"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/>`;
        case "tag":
            return `<path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/>`;
        case "clock":
            return `<circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>`;
        case "feather":
            return `<path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"/><line x1="16" y1="8" x2="2" y2="22"/><line x1="17.5" y1="15" x2="9" y2="15"/>`;
        case "tool":
            return `<path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>`;
        case "layout":
            return `<rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><line x1="3" x2="21" y1="9" y2="9"/><line x1="9" x2="9" y1="21" y2="9"/>`;
        default:
            return `<circle cx="12" cy="12" r="10"/>`;
    }
};
---

<BaseLayout
    title={product.title}
    description={product.focus}
    image={product.image}
>
    <!-- Modern Hero Section -->
    <section class="bg-slate-900 pt-32 pb-20 relative overflow-hidden">
        <!-- Background Elements -->
        <div class="absolute inset-0 z-0">
            <div
                class="absolute top-0 right-0 w-[500px] h-[500px] bg-blue-500/20 rounded-full blur-[100px] opacity-30 animate-pulse"
            >
            </div>
            <div
                class="absolute bottom-0 left-0 w-[500px] h-[500px] bg-yellow-500/10 rounded-full blur-[100px] opacity-20"
            >
            </div>
            <div
                class="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20"
            >
            </div>
        </div>

        <div class="container mx-auto px-4 md:px-6 relative z-10">
            <!-- Breadcrumb -->
            <nav class="mb-8 flex justify-center md:justify-start">
                <ol class="flex items-center gap-2 text-sm text-slate-400">
                    <li>
                        <a
                            href="/"
                            class="hover:text-blue-400 transition-colors"
                            >Beranda</a
                        >
                    </li>
                    <li>/</li>
                    <li>
                        <a
                            href="/produk"
                            class="hover:text-blue-400 transition-colors"
                            >Produk</a
                        >
                    </li>
                    <li>/</li>
                    <li class="text-white font-medium">{product.title}</li>
                </ol>
            </nav>

            <div class="flex flex-col md:flex-row gap-12 items-center">
                <div class="w-full md:w-1/2 text-center md:text-left">
                    <span
                        class="inline-block px-4 py-1.5 rounded-full bg-blue-600/20 border border-blue-500/30 text-blue-300 text-xs font-bold uppercase tracking-widest mb-6"
                    >
                        {product.tag}
                    </span>
                    <h1
                        class="text-4xl md:text-6xl font-bold text-white mb-6 tracking-tight leading-tight"
                    >
                        {product.title}
                    </h1>
                    <p
                        class="text-xl md:text-2xl text-slate-300 leading-relaxed mb-8 font-light"
                    >
                        {product.focus}
                    </p>
                    <div
                        class="flex flex-col sm:flex-row gap-4 justify-center md:justify-start"
                    >
                        <a
                            href="#spesifikasi"
                            class="inline-flex h-12 items-center justify-center rounded-xl bg-white text-slate-900 hover:bg-slate-100 font-bold text-sm uppercase tracking-wide px-8 transition-all"
                        >
                            Lihat Spesifikasi
                        </a>
                        <a
                            href={`https://wa.me/6288231309760?text=Halo%2C%20saya%20tertarik%20dengan%20produk%20${encodeURIComponent(product.title)}`}
                            target="_blank"
                            class="inline-flex h-12 items-center justify-center rounded-xl border border-white/20 hover:bg-white/10 text-white font-bold text-sm uppercase tracking-wide px-8 transition-all"
                        >
                            Konsultasi Gratis
                        </a>
                    </div>
                </div>

                <div class="w-full md:w-1/2">
                    <div class="relative group">
                        <div
                            class="absolute inset-0 bg-blue-500 blur-2xl opacity-20 group-hover:opacity-30 transition-opacity duration-500"
                        >
                        </div>
                        <img
                            src={product.image}
                            alt={product.title}
                            class="relative rounded-2xl shadow-2xl w-full aspect-video object-cover ring-1 ring-white/10"
                        />
                        <!-- Floating Badge -->
                        <div
                            class="absolute -bottom-6 -left-6 bg-white p-4 rounded-xl shadow-xl hidden md:block animate-float-slow"
                        >
                            <div class="flex items-center gap-3">
                                <div
                                    class="bg-yellow-100 p-2 rounded-lg text-yellow-600"
                                >
                                    <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        width="24"
                                        height="24"
                                        viewBox="0 0 24 24"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="2"
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        ><path
                                            d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"
                                        ></path></svg
                                    >
                                </div>
                                <div>
                                    <div
                                        class="text-xs text-slate-500 uppercase font-bold"
                                    >
                                        Garansi
                                    </div>
                                    <div class="text-slate-900 font-bold">
                                        2 Tahun Komponen
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Bento Grid Features -->
    {
        product.bentoFeatures && (
            <section class="py-20 bg-white">
                <div class="container mx-auto px-4 md:px-6">
                    <div class="text-center max-w-3xl mx-auto mb-16">
                        <h2 class="text-[#072181] font-bold text-sm uppercase tracking-widest mb-3">
                            Keunggulan
                        </h2>
                        <h3 class="text-3xl md:text-4xl font-bold text-slate-900 tracking-tight">
                            Kenapa Memilih {product.title}?
                        </h3>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-6xl mx-auto">
                        {product.bentoFeatures.map((feature: any) => (
                            <div
                                class={`group relative overflow-hidden rounded-3xl bg-slate-50 border border-slate-100 p-8 hover:shadow-xl transition-all duration-300 ${feature.cols === 2 ? "md:col-span-2" : ""}`}
                            >
                                {feature.image && (
                                    <div class="absolute inset-0 z-0">
                                        <div class="absolute inset-0 bg-gradient-to-t from-slate-900/90 via-slate-900/40 to-transparent" />
                                        <img
                                            src={feature.image}
                                            alt={feature.title}
                                            class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700"
                                        />
                                    </div>
                                )}

                                <div class="relative z-10 h-full flex flex-col justify-end">
                                    <div
                                        class={`mb-4 inline-flex items-center justify-center w-12 h-12 rounded-xl  ${feature.image ? "bg-white/20 backdrop-blur-md text-white" : "bg-blue-100 text-blue-600"}`}
                                    >
                                        <svg
                                            xmlns="http://www.w3.org/2000/svg"
                                            width="24"
                                            height="24"
                                            viewBox="0 0 24 24"
                                            fill="none"
                                            stroke="currentColor"
                                            stroke-width="2"
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            set:html={getIcon(feature.icon)}
                                        />
                                    </div>
                                    <h4
                                        class={`text-xl font-bold mb-2 ${feature.image ? "text-white" : "text-slate-900"}`}
                                    >
                                        {feature.title}
                                    </h4>
                                    <p
                                        class={`text-sm leading-relaxed ${feature.image ? "text-slate-200" : "text-slate-600"}`}
                                    >
                                        {feature.description}
                                    </p>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            </section>
        )
    }

    <!-- Product Details & Specs -->
    <section id="spesifikasi" class="py-20 bg-slate-50 relative">
        <div class="container mx-auto px-4 md:px-6">
            <div class="grid lg:grid-cols-12 gap-12">
                <!-- Description -->
                <div class="lg:col-span-5">
                    <h2 class="text-2xl font-bold text-slate-900 mb-6">
                        Deskripsi Lengkap
                    </h2>
                    <div
                        class="prose prose-lg prose-slate text-slate-600 leading-relaxed"
                    >
                        <p>{product.content || product.excerpt}</p>
                        <div
                            class="mt-8 p-6 bg-blue-50 border border-blue-100 rounded-2xl"
                        >
                            <h4
                                class="text-blue-900 font-bold mb-2 flex items-center gap-2"
                            >
                                <svg
                                    xmlns="http://www.w3.org/2000/svg"
                                    width="18"
                                    height="18"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    ><circle cx="12" cy="12" r="10"
                                    ></circle><line
                                        x1="12"
                                        y1="16"
                                        x2="12"
                                        y2="12"></line><line
                                        x1="12"
                                        y1="8"
                                        x2="12.01"
                                        y2="8"></line></svg
                                >
                                Informasi Tambahan
                            </h4>
                            <p class="text-sm text-blue-700">
                                Hubungi tim ahli kami untuk survei lokasi gratis
                                dan perhitungan estimasi biaya yang presisi
                                sesuai ukuran ruangan Anda.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Specs Table -->
                <div class="lg:col-span-7">
                    <div
                        class="bg-white rounded-3xl shadow-sm border border-slate-100 overflow-hidden"
                    >
                        <div
                            class="p-6 md:p-8 bg-[#072181] text-white flex justify-between items-center"
                        >
                            <h3 class="text-xl font-bold">
                                Spesifikasi Teknis
                            </h3>
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                width="24"
                                height="24"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                class="opacity-50"
                                ><path
                                    d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"
                                ></path></svg
                            >
                        </div>
                        <div class="divide-y divide-slate-100">
                            {
                                product.specs.map((spec: any) => (
                                    <div class="flex flex-col md:flex-row p-5 md:p-6 hover:bg-slate-50 transition-colors">
                                        <div class="md:w-1/3 text-sm font-bold uppercase tracking-wider text-slate-500 mb-1 md:mb-0">
                                            {spec.label}
                                        </div>
                                        <div class="md:w-2/3 font-medium text-slate-900">
                                            {spec.value}
                                        </div>
                                    </div>
                                ))
                            }
                        </div>
                    </div>

                    <!-- Action -->
                    <div
                        class="mt-8 flex flex-col md:flex-row gap-4 justify-end"
                    >
                        <a
                            href={`https://wa.me/6288231309760?text=Halo%2C%20saya%20ingin%20pesan%20${encodeURIComponent(product.title)}`}
                            target="_blank"
                            class="inline-flex h-14 items-center justify-center rounded-xl bg-[#25D366] hover:bg-[#20bd5a] text-white font-bold text-base px-8 gap-2 shadow-lg shadow-green-500/20 transition-all transform hover:-translate-y-1"
                        >
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                width="24"
                                height="24"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                ><path
                                    d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"
                                ></path></svg
                            >
                            Pesan via WhatsApp
                        </a>
                        {
                            ["sorepa", "samowa", "nice-partition"].includes(
                                product.slug,
                            ) && (
                                <a
                                    href="/COMPRO PIREKI 2026.pdf"
                                    target="_blank"
                                    class="inline-flex h-14 items-center justify-center rounded-xl border-2 border-[#072181] text-[#072181] hover:bg-[#072181] hover:text-white font-bold text-base px-8 gap-2 transition-all transform hover:-translate-y-1"
                                >
                                    <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        width="24"
                                        height="24"
                                        viewBox="0 0 24 24"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="2"
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        class="lucide lucide-file-down"
                                    >
                                        <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" />
                                        <polyline points="14 2 14 8 20 8" />
                                        <path d="M12 18v-6" />
                                        <path d="m9 15 3 3 3-3" />
                                    </svg>
                                    Download Brosur
                                </a>
                            )
                        }
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- CTA -->
    <CTA />
</BaseLayout>

<style>
    @keyframes float-slow {
        0%,
        100% {
            transform: translateY(0);
        }
        50% {
            transform: translateY(-10px);
        }
    }
    .animate-float-slow {
        animation: float-slow 4s ease-in-out infinite;
    }
</style>
